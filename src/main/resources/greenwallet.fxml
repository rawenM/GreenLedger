<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.scene.layout.*?>
<?import javafx.scene.control.*?>
<?import javafx.scene.web.WebView?>
<?import javafx.geometry.Insets?>
<?import java.lang.String?>

<!--
    ELITE GREEN WALLET UI - Production Ready v2.0
    
    Design Philosophy:
    - Single-window architecture with slide-in panels (no popups)
    - Loss aversion framing at top ("X tCOâ‚‚e above baseline")
    - Mental accounting with Scope 1/2/3 waterfall breakdown
    - Status signaling with verification badges and tier indicators
    - Interactive pollution map replacing text-based API results
    - Behavioral psychology triggers throughout (social proof, scarcity, commitment)
    
    Architecture:
    - StackPane root for layered panels
    - Main layer: HBox with sidebar + BorderPane content
    - Overlay panels: Slide in from right with TranslateTransition
    - WebView for Leaflet.js map in bottom section
    - Real-time metrics with Reactor subscriptions
-->

<StackPane xmlns="http://javafx.com/javafx/20.0.2"
           xmlns:fx="http://javafx.com/fxml/1"
           fx:controller="Controllers.GreenWalletController"
           styleClass="root-pane">

    <!-- MAIN LAYER: Fixed Layout -->
    <HBox fx:id="mainLayer" spacing="0" styleClass="page">

        <!-- LEFT SIDEBAR -->
        <VBox prefWidth="220" styleClass="sidebar" style="-fx-min-width: 220; -fx-max-width: 220;">

            <HBox alignment="CENTER_LEFT" spacing="8">
                <Label text="ðŸŒ¿" style="-fx-font-size: 20px;"/>
                <Label text="GreenLedger" styleClass="sidebar-title"/>
            </HBox>

            <Separator styleClass="sidebar-sep"/>

            <Button text="â† Retour" styleClass="btn btn-secondary" onAction="#onBack"/>

            <Button fx:id="btnGestionProjets" text="ðŸ“ Gestion Projets" styleClass="nav-btn" onAction="#onGestionProjets"/>
            <Button fx:id="btnWalletOverview" text="ðŸ’³ GreenWallet" styleClass="nav-btn active"/>
            <Button fx:id="btnMarketplace" text="ðŸ›’ Marketplace" styleClass="nav-btn" onAction="#onMarketplace"/>
            <Button fx:id="btnSettings" text="âš™ Settings" styleClass="nav-btn"/>

            <Separator styleClass="sidebar-sep" style="-fx-margin: 12 0;"/>
            
            <!-- Quick Stats in Sidebar -->
            <VBox spacing="8" style="-fx-padding: 12 8;">
                <Label text="AperÃ§u Rapide" style="-fx-font-size: 10px; -fx-opacity: 0.6; -fx-font-weight: 600;"/>
                <HBox spacing="6" alignment="CENTER_LEFT">
                    <Label text="ðŸ’°" style="-fx-font-size: 12px;"/>
                    <Label fx:id="lblSidebarAvailable" text="0.00 tCOâ‚‚" style="-fx-font-size: 11px; -fx-font-weight: 600; -fx-text-fill: #10b981;"/>
                </HBox>
                <HBox spacing="6" alignment="CENTER_LEFT">
                    <Label text="âŒ" style="-fx-font-size: 12px;"/>
                    <Label fx:id="lblSidebarRetired" text="0.00 tCOâ‚‚" style="-fx-font-size: 11px; -fx-font-weight: 600; -fx-text-fill: #f59e0b;"/>
                </HBox>
                <HBox spacing="6" alignment="CENTER_LEFT">
                    <Label text="ðŸŽ¯" style="-fx-font-size: 12px;"/>
                    <Label fx:id="lblSidebarGoal" text="Goal: 100 tCOâ‚‚" style="-fx-font-size: 11px; -fx-opacity: 0.8;"/>
                </HBox>
            </VBox>

            <Region VBox.vgrow="ALWAYS"/>
            
            <!-- User Context Footer -->
            <VBox spacing="4" style="-fx-padding: 12 8; -fx-background-color: rgba(0,0,0,0.05); -fx-border-radius: 8; -fx-background-radius: 8; -fx-margin: 8;">
                <Label fx:id="lblProfileName" text="User Name" style="-fx-font-size: 11px; -fx-font-weight: 600;"/>
                <Label fx:id="lblProfileType" text="Account Type" style="-fx-font-size: 9px; -fx-opacity: 0.7;"/>
            </VBox>
        </VBox>


        <!-- MAIN CONTENT AREA -->
        <BorderPane HBox.hgrow="ALWAYS" styleClass="content-wrapper">
            
            <!-- TOP: IMPACT BAR (Loss Framed) -->
            <top>
                <VBox spacing="0">
                    <!-- Real-time Impact Bar -->
                    <HBox fx:id="impactBar" alignment="CENTER_LEFT" spacing="12" 
                          style="-fx-padding: 16 24; -fx-background-color: linear-gradient(to right, #fee2e2, #fef3c7); -fx-border-color: #fbbf24; -fx-border-width: 0 0 2 0;">
                        <Label text="âš " style="-fx-font-size: 24px;"/>
                        <VBox spacing="2" HBox.hgrow="ALWAYS">
                            <Label text="Impact Alert" style="-fx-font-size: 11px; -fx-font-weight: 600; -fx-opacity: 0.8;"/>
                            <HBox spacing="8" alignment="CENTER_LEFT">
                                <Label fx:id="lblImpactAmount" text="+125.5 tCOâ‚‚e" 
                                       style="-fx-font-size: 22px; -fx-font-weight: 700; -fx-text-fill: #dc2626;"/>
                                <Label text="au-dessus de la baseline industrie" style="-fx-font-size: 13px; -fx-opacity: 0.9;"/>
                            </HBox>
                        </VBox>
                        <VBox spacing="2" alignment="CENTER_RIGHT">
                            <Label text="Objectif" style="-fx-font-size: 10px; -fx-opacity: 0.7;"/>
                            <Label fx:id="lblImpactGoal" text="72% complÃ©tÃ©" style="-fx-font-size: 14px; -fx-font-weight: 600;"/>
                        </VBox>
                        <ProgressBar fx:id="progressImpact" progress="0.72" prefWidth="160" prefHeight="12" 
                                     style="-fx-accent: #f59e0b;"/>
                    </HBox>
                    
                    <!-- Page Header -->
                    <HBox spacing="12" alignment="CENTER_LEFT" style="-fx-padding: 16 24 12 24;">
                        <Label text="ðŸŒ± Portefeuille Carbone" styleClass="page-title"/>
                        <Region HBox.hgrow="ALWAYS"/>
                        
                        <!-- Wallet Info Display -->
                        <VBox spacing="2" style="-fx-padding: 8 12; -fx-background-color: #f3f4f6; -fx-background-radius: 8;">
                            <HBox spacing="8" alignment="CENTER_LEFT">
                                <Label text="Wallet:" style="-fx-font-size: 10px; -fx-opacity: 0.7;"/>
                                <Label fx:id="lblWalletNumber" text="â€”" style="-fx-font-size: 11px; -fx-font-weight: 600; -fx-font-family: monospace;"/>
                                <Label text="|" style="-fx-font-size: 10px; -fx-opacity: 0.3;"/>
                                <Label fx:id="lblHolderName" text="â€”" style="-fx-font-size: 11px; -fx-font-weight: 600;"/>
                            </HBox>
                            <HBox spacing="8" alignment="CENTER_LEFT">
                                <Label fx:id="lblOwnerType" text="â€”" style="-fx-font-size: 10px; -fx-opacity: 0.7;"/>
                                <Label text="â€¢" style="-fx-font-size: 10px; -fx-opacity: 0.3;"/>
                                <Label fx:id="lblStatus" text="â€”" style="-fx-font-size: 10px; -fx-text-fill: #10b981;"/>
                            </HBox>
                        </VBox>
                        
                        <ComboBox fx:id="cmbWalletSelector" promptText="SÃ©lectionner Wallet" prefWidth="220" styleClass="field"/>
                        <Button fx:id="btnCreateWallet" text="+ Nouveau" styleClass="btn btn-secondary" prefHeight="34"/>
                    </HBox>
                </VBox>
            </top>
            
            <!-- CENTER: MAIN DASHBOARD -->
            <center>
                <ScrollPane fitToWidth="true" fitToHeight="false" style="-fx-background-color: transparent; -fx-background: transparent;">
                    <VBox spacing="16" style="-fx-padding: 0 24 20 24;">
                        
                        <!-- SCOPE BREAKDOWN WATERFALL -->
                        <VBox spacing="12" styleClass="card" style="-fx-padding: 20;">
                            <HBox spacing="8" alignment="CENTER_LEFT">
                                <Label text="ðŸ“Š" style="-fx-font-size: 16;"/>
                                <Label text="DÃ©composition par Scope GHG" styleClass="section-title"/>
                                <Region HBox.hgrow="ALWAYS"/>
                                <Label fx:id="lblScopeDataQuality" text="ðŸ¥‡ Tier 2 Data Quality" 
                                       style="-fx-font-size: 11px; -fx-padding: 4 10; -fx-background-color: #d1fae5; -fx-background-radius: 12; -fx-text-fill: #065f46; -fx-font-weight: 600;"/>
                            </HBox>
                            
                            <!-- Waterfall Chart Container (Canvas will be injected here by controller) -->
                            <Pane fx:id="waterfallChartPane" prefHeight="200" 
                                  style="-fx-background-color: #f9fafb; -fx-border-color: #e5e7eb; -fx-border-radius: 8; -fx-background-radius: 8;">
                                <!-- JavaScript Canvas or JavaFX Canvas for waterfall chart -->
                            </Pane>
                            
                            <!-- Scope Stats Grid -->
                            <GridPane hgap="12" vgap="10" style="-fx-padding: 12 0 0 0;">
                                <VBox spacing="4" GridPane.columnIndex="0" GridPane.rowIndex="0">
                                    <Label text="Scope 1: Direct" style="-fx-font-size: 11px; -fx-opacity: 0.7; -fx-font-weight: 600;"/>
                                    <HBox spacing="6" alignment="CENTER_LEFT">
                                        <Label fx:id="lblScope1Amount" text="32.5 tCOâ‚‚e" 
                                               style="-fx-font-size: 18px; -fx-font-weight: 700; -fx-text-fill: #ef4444;"/>
                                        <Label text="(26%)" style="-fx-font-size: 12px; -fx-opacity: 0.6;"/>
                                    </HBox>
                                    <Label text="Fleet, On-site Fuel" style="-fx-font-size: 10px; -fx-opacity: 0.6;"/>
                                </VBox>
                                
                                <VBox spacing="4" GridPane.columnIndex="1" GridPane.rowIndex="0">
                                    <Label text="Scope 2: Ã‰nergie" style="-fx-font-size: 11px; -fx-opacity: 0.7; -fx-font-weight: 600;"/>
                                    <HBox spacing="6" alignment="CENTER_LEFT">
                                        <Label fx:id="lblScope2Amount" text="45.3 tCOâ‚‚e" 
                                               style="-fx-font-size: 18px; -fx-font-weight: 700; -fx-text-fill: #f97316;"/>
                                        <Label text="(36%)" style="-fx-font-size: 12px; -fx-opacity: 0.6;"/>
                                    </HBox>
                                    <Label text="Electricity, Steam" style="-fx-font-size: 10px; -fx-opacity: 0.6;"/>
                                </VBox>
                                
                                <VBox spacing="4" GridPane.columnIndex="2" GridPane.rowIndex="0">
                                    <Label text="Scope 3: ChaÃ®ne" style="-fx-font-size: 11px; -fx-opacity: 0.7; -fx-font-weight: 600;"/>
                                    <HBox spacing="6" alignment="CENTER_LEFT">
                                        <Label fx:id="lblScope3Amount" text="47.7 tCOâ‚‚e" 
                                               style="-fx-font-size: 18px; -fx-font-weight: 700; -fx-text-fill: #d97706;"/>
                                        <Label text="(38%)" style="-fx-font-size: 12px; -fx-opacity: 0.6;"/>
                                    </HBox>
                                    <Label text="Procurement, Travel" style="-fx-font-size: 10px; -fx-opacity: 0.6;"/>
                                </VBox>
                            </GridPane>
                        </VBox>
                        
                        <!-- INTERACTIVE MAP + BATCH EXPLORER (SPLIT VIEW) -->
                        <HBox spacing="16" prefHeight="400">
                            
                            <!-- MAP SECTION (60%) -->
                            <VBox spacing="12" styleClass="card" style="-fx-padding: 20;" HBox.hgrow="ALWAYS" prefWidth="600">
                                <HBox spacing="8" alignment="CENTER_LEFT">
                                    <Label text="ðŸ—ºï¸" style="-fx-font-size: 16;"/>
                                    <Label text="Carte de Pollution Interactive" styleClass="section-title"/>
                                    <Region HBox.hgrow="ALWAYS"/>
                                    <Button fx:id="btnMapFullscreen" text="â›¶ Plein Ã‰cran" styleClass="btn btn-icon" prefHeight="28"/>
                                </HBox>
                                
                                <WebView fx:id="mapWebView" prefHeight="320" style="-fx-border-color: #e5e7eb; -fx-border-radius: 8;"/>
                                
                                <HBox spacing="10" alignment="CENTER_LEFT">
                                    <VBox spacing="2" style="-fx-padding: 6 12; -fx-background-color: #f0fdf4; -fx-background-radius: 6;">
                                        <Label text="ðŸŸ¢ Bon (0-50 AQI)" style="-fx-font-size: 10px;"/>
                                    </VBox>
                                    <VBox spacing="2" style="-fx-padding: 6 12; -fx-background-color: #fef3c7; -fx-background-radius: 6;">
                                        <Label text="ðŸŸ¡ ModÃ©rÃ© (51-100)" style="-fx-font-size: 10px;"/>
                                    </VBox>
                                    <VBox spacing="2" style="-fx-padding: 6 12; -fx-background-color: #fed7aa; -fx-background-radius: 6;">
                                        <Label text="ðŸŸ  Mauvais (101-150)" style="-fx-font-size: 10px;"/>
                                    </VBox>
                                    <VBox spacing="2" style="-fx-padding: 6 12; -fx-background-color: #fecaca; -fx-background-radius: 6;">
                                        <Label text="ðŸ”´ TrÃ¨s Mauvais (151+)" style="-fx-font-size: 10px;"/>
                                    </VBox>
                                </HBox>
                            </VBox>
                            
                            <!-- BATCH EXPLORER (40%) -->
                            <VBox spacing="12" styleClass="card" style="-fx-padding: 20;" prefWidth="400">
                                <HBox spacing="8" alignment="CENTER_LEFT">
                                    <Label text="ðŸ“¦" style="-fx-font-size: 16;"/>
                                    <Label text="Batches RÃ©cents" styleClass="section-title"/>
                                    <Region HBox.hgrow="ALWAYS"/>
                                    <Button fx:id="btnViewAllBatches" text="Voir Tous" styleClass="btn btn-link" prefHeight="28"/>
                                </HBox>
                                
                                <ListView fx:id="listBatches" prefHeight="280" style="-fx-border-color: #e5e7eb; -fx-border-radius: 8; -fx-background-radius: 8;">
                                    <placeholder>
                                        <VBox spacing="8" alignment="CENTER" style="-fx-padding: 40;">
                                            <Label text="ðŸ“¦" style="-fx-font-size: 32; -fx-opacity: 0.3;"/>
                                            <Label text="Aucun batch" style="-fx-font-size: 12; -fx-opacity: 0.6;"/>
                                        </VBox>
                                    </placeholder>
                                </ListView>
                                
                                <Button fx:id="btnIssueBatch" text="+ Nouveau Batch" styleClass="btn btn-primary" prefHeight="36"/>
                            </VBox>
                        </HBox>
                        
                        <!-- STAT CARDS + PEER BENCHMARK -->
                        <HBox spacing="12">
                            <!-- Available Credits -->
                            <VBox styleClass="stat-card gradient-green" HBox.hgrow="ALWAYS" alignment="TOP_LEFT" spacing="6">
                                <Label text="ðŸ’° CRÃ‰DITS DISPONIBLES" styleClass="stat-title"/>
                                <Label fx:id="lblAvailableCredits" text="0.00 tCOâ‚‚" styleClass="stat-value" 
                                       style="-fx-font-size: 32; -fx-text-fill: #059669;"/>
                                <HBox spacing="6" alignment="CENTER_LEFT">
                                    <Label text="â†‘ +12.5" style="-fx-font-size: 12px; -fx-text-fill: #10b981; -fx-font-weight: 600;"/>
                                    <Label text="cette semaine" style="-fx-font-size: 11px; -fx-opacity: 0.7;"/>
                                </HBox>
                            </VBox>
                            
                            <!-- Retired Credits -->
                            <VBox styleClass="stat-card gradient-amber" HBox.hgrow="ALWAYS" alignment="TOP_LEFT" spacing="6">
                                <Label text="âŒ CRÃ‰DITS RETIRÃ‰S" styleClass="stat-title"/>
                                <Label fx:id="lblRetiredCredits" text="0.00 tCOâ‚‚" styleClass="stat-value" 
                                       style="-fx-font-size: 32; -fx-text-fill: #d97706;"/>
                                <HBox spacing="6" alignment="CENTER_LEFT">
                                    <Label text="ðŸŽ¯ 87%" style="-fx-font-size: 12px; -fx-font-weight: 600;"/>
                                    <Label text="objectif annuel" style="-fx-font-size: 11px; -fx-opacity: 0.7;"/>
                                </HBox>
                            </VBox>
                            
                            <!-- Peer Benchmark (Social Proof) -->
                            <VBox styleClass="stat-card gradient-blue" HBox.hgrow="ALWAYS" alignment="TOP_LEFT" spacing="6">
                                <Label text="ðŸ“Š CLASSEMENT PAIR" styleClass="stat-title"/>
                                <Label fx:id="lblPeerRank" text="Top 23%" styleClass="stat-value" 
                                       style="-fx-font-size: 32; -fx-text-fill: #2563eb;"/>
                                <HBox spacing="6" alignment="CENTER_LEFT">
                                    <Label text="â­" style="-fx-font-size: 12px;"/>
                                    <Label text="Meilleur que 77% du secteur" style="-fx-font-size: 11px; -fx-opacity: 0.8;"/>
                                </HBox>
                            </VBox>
                        </HBox>
                        
                        <!-- TRANSACTIONS TABLE -->
                        <VBox spacing="12" styleClass="card" style="-fx-padding: 20;">
                            <HBox spacing="8" alignment="CENTER_LEFT">
                                <Label text="ðŸ“œ" style="-fx-font-size: 16;"/>
                                <Label text="Historique des Transactions" styleClass="section-title"/>
                                <Region HBox.hgrow="ALWAYS"/>
                                <Button fx:id="btnRefresh" text="ðŸ”„" styleClass="btn btn-icon" prefHeight="32"/>
                                <Button fx:id="btnFilterTransactions" text="âš™ Filtrer" styleClass="btn btn-secondary" prefHeight="32"/>
                            </HBox>

                            <TableView fx:id="tableTransactions" prefHeight="280" styleClass="elite-table">
                                <placeholder>
                                    <VBox spacing="8" alignment="CENTER" style="-fx-padding: 60;">
                                        <Label text="ðŸ“‹" style="-fx-font-size: 42; -fx-opacity: 0.25;"/>
                                        <Label text="Aucune transaction enregistrÃ©e" style="-fx-font-size: 14; -fx-font-weight: 600; -fx-opacity: 0.5;"/>
                                        <Label text="Les opÃ©rations apparaÃ®tront automatiquement" style="-fx-font-size: 12; -fx-opacity: 0.4;"/>
                                    </VBox>
                                </placeholder>
                                <columns>
                                    <TableColumn fx:id="colTransactionId" text="ID" prefWidth="60"/>
                                    <TableColumn fx:id="colTransactionType" text="Type" prefWidth="120"/>
                                    <TableColumn fx:id="colTransactionAmount" text="Montant (tCOâ‚‚)" prefWidth="130"/>
                                    <TableColumn fx:id="colTransactionDate" text="Date" prefWidth="150"/>
                                    <TableColumn fx:id="colTransactionReference" text="RÃ©fÃ©rence" prefWidth="200"/>
                                    <TableColumn fx:id="colTransactionStatus" text="Statut" prefWidth="100"/>
                                </columns>
                            </TableView>
                        </VBox>
                        
                        <!-- ACTION BUTTONS -->
                        <HBox spacing="12" alignment="CENTER_LEFT" style="-fx-padding: 8 0;">
                            <Button fx:id="btnIssueCreditsMain" text="âž•  Ã‰mettre CrÃ©dits" styleClass="btn btn-primary" 
                                    prefHeight="42" prefWidth="180" onAction="#onShowIssuePanel"/>
                            <Button fx:id="btnRetireCreditsMain" text="âŒ  Retirer CrÃ©dits" styleClass="btn btn-secondary" 
                                    prefHeight="42" prefWidth="170" onAction="#onShowRetirePanel"/>
                            <Button fx:id="btnTransferCredits" text="ðŸ”„  TransfÃ©rer" styleClass="btn btn-secondary" 
                                    prefHeight="42" prefWidth="140" onAction="#onShowTransferPanel"/>
                            <Region HBox.hgrow="ALWAYS"/>
                            <Button fx:id="btnCalculateEmissions" text="âš¡ Calculer Ã‰missions" styleClass="btn btn-accent" 
                                    prefHeight="42" prefWidth="180" onAction="#onShowEmissionsPanel"/>
                            <Button fx:id="btnExport" text="ðŸ“¥  Exporter CSV" styleClass="btn btn-secondary" 
                                    prefHeight="42" prefWidth="140" onAction="#onExportCsv"/>
                        </HBox>
                        
                    </VBox>
                </ScrollPane>
            </center>
            
        </BorderPane>

    </HBox>

    <!-- SLIDE-IN PANEL OVERLAY: Issue Credits -->
    <VBox fx:id="issueCreditPanel" translateX="1200" managed="false" 
          styleClass="slide-panel" style="-fx-min-width: 520; -fx-max-width: 520;">
        <HBox alignment="CENTER_LEFT" spacing="12" styleClass="slide-panel-header">
            <Label text="âž•" style="-fx-font-size: 24px;"/>
            <Label text="Ã‰mettre Nouveaux CrÃ©dits" styleClass="slide-panel-title"/>
            <Region HBox.hgrow="ALWAYS"/>
            <Button text="âœ•" styleClass="btn btn-icon" onAction="#onCloseIssuePanel" prefWidth="32" prefHeight="32"/>
        </HBox>
        
        <ScrollPane fitToWidth="true" VBox.vgrow="ALWAYS" style="-fx-background-color: transparent;">
            <VBox spacing="16" style="-fx-padding: 24;">
                
                <VBox spacing="8">
                    <Label text="Montant de CrÃ©dits (tCOâ‚‚)" styleClass="form-label"/>
                    <TextField fx:id="txtIssueAmount" promptText="Ex: 100.50" styleClass="field"/>
                    <Label text="Minimum: 1 tCOâ‚‚ â€¢ Maximum: 10,000 tCOâ‚‚" style="-fx-font-size: 10px; -fx-opacity: 0.6;"/>
                </VBox>
                
                <VBox spacing="8">
                    <Label text="Standard de VÃ©rification" styleClass="form-label"/>
                    <ComboBox fx:id="cmbVerificationStandard" promptText="SÃ©lectionner standard" prefWidth="1000" styleClass="field">
                        <items>
                            <javafx.collections.FXCollections fx:factory="observableArrayList">
                                <String fx:value="VCS (Verified Carbon Standard)"/>
                                <String fx:value="Gold Standard"/>
                                <String fx:value="CDM (Clean Development Mechanism)"/>
                                <String fx:value="CAR (Climate Action Reserve)"/>
                            </javafx.collections.FXCollections>
                        </items>
                    </ComboBox>
                </VBox>
                
                <VBox spacing="8">
                    <Label text="AnnÃ©e MillÃ©sime (Vintage)" styleClass="form-label"/>
                    <TextField fx:id="txtVintageYear" promptText="2024" styleClass="field"/>
                </VBox>
                
                <VBox spacing="8">
                    <Label text="ID Audit de Calcul (optionnel)" styleClass="form-label"/>
                    <TextField fx:id="txtCalculationAuditId" promptText="Audit #..." styleClass="field"/>
                </VBox>
                
                <VBox spacing="8">
                    <Label text="RÃ©fÃ©rence / Notes" styleClass="form-label"/>
                    <TextArea fx:id="txtIssueReference" promptText="RÃ©fÃ©rence du projet source..." wrapText="true" 
                              prefRowCount="3" styleClass="field"/>
                </VBox>
                
                <Separator/>
                
                <VBox spacing="8" style="-fx-padding: 12; -fx-background-color: #f0fdf4; -fx-border-color: #86efac; -fx-border-width: 2; -fx-background-radius: 8; -fx-border-radius: 8;">
                    <Label text="âœ“ AperÃ§u" style="-fx-font-weight: 600; -fx-font-size: 13px;"/>
                    <HBox spacing="8">
                        <Label text="Montant:" style="-fx-font-weight: 600; -fx-min-width: 100;"/>
                        <Label fx:id="lblIssuePreviewAmount" text="â€”" style="-fx-text-fill: #059669; -fx-font-weight: 700;"/>
                    </HBox>
                    <HBox spacing="8">
                        <Label text="SÃ©rie:" style="-fx-font-weight: 600; -fx-min-width: 100;"/>
                        <Label fx:id="lblIssuePreviewSerial" text="CC-2024-XXXXXX" style="-fx-font-family: monospace;"/>
                    </HBox>
                    <HBox spacing="8">
                        <Label text="Standard:" style="-fx-font-weight: 600; -fx-min-width: 100;"/>
                        <Label fx:id="lblIssuePreviewStandard" text="â€”"/>
                    </HBox>
                </VBox>
                
                <HBox spacing="12" style="-fx-padding: 12 0 0 0;">
                    <Button fx:id="btnConfirmIssue" text="âœ“ Confirmer Ã‰mission" styleClass="btn btn-primary" 
                            prefHeight="42" HBox.hgrow="ALWAYS" onAction="#onConfirmIssue"/>
                    <Button text="Annuler" styleClass="btn btn-secondary" prefHeight="42" prefWidth="120" 
                            onAction="#onCloseIssuePanel"/>
                </HBox>
            </VBox>
        </ScrollPane>
    </VBox>

    <!-- SLIDE-IN PANEL OVERLAY: Retire Credits -->
    <VBox fx:id="retireCreditPanel" translateX="1200" managed="false" 
          styleClass="slide-panel" style="-fx-min-width: 520; -fx-max-width: 520;">
        <HBox alignment="CENTER_LEFT" spacing="12" styleClass="slide-panel-header">
            <Label text="âŒ" style="-fx-font-size: 24px;"/>
            <Label text="Retirer CrÃ©dits (Offset Permanent)" styleClass="slide-panel-title"/>
            <Region HBox.hgrow="ALWAYS"/>
            <Button text="âœ•" styleClass="btn btn-icon" onAction="#onCloseRetirePanel" prefWidth="32" prefHeight="32"/>
        </HBox>
        
        <ScrollPane fitToWidth="true" VBox.vgrow="ALWAYS" style="-fx-background-color: transparent;">
            <VBox spacing="16" style="-fx-padding: 24;">
                
                <VBox spacing="8" style="-fx-padding: 12; -fx-background-color: #fef3c7; -fx-border-color: #fbbf24; -fx-border-width: 2; -fx-background-radius: 8; -fx-border-radius: 8;">
                    <HBox spacing="8" alignment="CENTER_LEFT">
                        <Label text="âš ï¸" style="-fx-font-size: 18px;"/>
                        <Label text="Action IrrÃ©versible" style="-fx-font-weight: 700; -fx-font-size: 14px;"/>
                    </HBox>
                    <Label text="Les crÃ©dits retirÃ©s ne peuvent pas Ãªtre rÃ©utilisÃ©s. Cette action compense dÃ©finitivement vos Ã©missions." 
                           wrapText="true" style="-fx-font-size: 12px;"/>
                </VBox>
                
                <VBox spacing="8">
                    <Label text="Montant Ã  Retirer (tCOâ‚‚)" styleClass="form-label"/>
                    <TextField fx:id="txtRetireAmount" promptText="Ex: 25.00" styleClass="field"/>
                    <HBox spacing="6" alignment="CENTER_LEFT">
                        <Label text="Disponible:" style="-fx-font-size: 11px; -fx-opacity: 0.7;"/>
                        <Label fx:id="lblRetireAvailable" text="0.00 tCOâ‚‚" style="-fx-font-size: 11px; -fx-font-weight: 600; -fx-text-fill: #10b981;"/>
                    </HBox>
                </VBox>
                
                <VBox spacing="8">
                    <Label text="Raison du Retrait" styleClass="form-label"/>
                    <ComboBox fx:id="cmbRetireReason" promptText="SÃ©lectionner raison" prefWidth="1000" styleClass="field">
                        <items>
                            <javafx.collections.FXCollections fx:factory="observableArrayList">
                                <String fx:value="Offsetting Scope 1 Emissions"/>
                                <String fx:value="Offsetting Scope 2 Emissions"/>
                                <String fx:value="Offsetting Scope 3 Emissions"/>
                                <String fx:value="Event/Product Carbon Neutral"/>
                                <String fx:value="Voluntary Retirement"/>
                                <String fx:value="Regulatory Compliance"/>
                            </javafx.collections.FXCollections>
                        </items>
                    </ComboBox>
                </VBox>
                
                <VBox spacing="8">
                    <Label text="Notes / Justification" styleClass="form-label"/>
                    <TextArea fx:id="txtRetireReason" promptText="DÃ©crivez l'utilisation..." wrapText="true" 
                              prefRowCount="4" styleClass="field"/>
                </VBox>
                
                <Separator/>
                
                <VBox spacing="8" style="-fx-padding: 12; -fx-background-color: #fef2f2; -fx-border-color: #fca5a5; -fx-border-width: 2; -fx-background-radius: 8; -fx-border-radius: 8;">
                    <Label text="âš¡ Impact ImmÃ©diat" style="-fx-font-weight: 600; -fx-font-size: 13px;"/>
                    <HBox spacing="8">
                        <Label text="RÃ©duction COâ‚‚:" style="-fx-font-weight: 600; -fx-min-width: 120;"/>
                        <Label fx:id="lblRetirePreviewAmount" text="-25.00 tCOâ‚‚e" style="-fx-text-fill: #dc2626; -fx-font-weight: 700;"/>
                    </HBox>
                    <HBox spacing="8">
                        <Label text="Nouveau Solde:" style="-fx-font-weight: 600; -fx-min-width: 120;"/>
                        <Label fx:id="lblRetirePreviewBalance" text="â€”"/>
                    </HBox>
                </VBox>
                
                <HBox spacing="12" style="-fx-padding: 12 0 0 0;">
                    <Button fx:id="btnConfirmRetire" text="âœ“ Confirmer Retrait DÃ©finitif" styleClass="btn btn-danger" 
                            prefHeight="42" HBox.hgrow="ALWAYS" onAction="#onConfirmRetire"/>
                    <Button text="Annuler" styleClass="btn btn-secondary" prefHeight="42" prefWidth="120" 
                            onAction="#onCloseRetirePanel"/>
                </HBox>
            </VBox>
        </ScrollPane>
    </VBox>

    <!-- SLIDE-IN PANEL OVERLAY: Transfer Credits -->
    <VBox fx:id="transferCreditPanel" translateX="1200" managed="false" 
          styleClass="slide-panel" style="-fx-min-width: 520; -fx-max-width: 520;">
        <HBox alignment="CENTER_LEFT" spacing="12" styleClass="slide-panel-header">
            <Label text="ðŸ”„" style="-fx-font-size: 24px;"/>
            <Label text="TransfÃ©rer CrÃ©dits" styleClass="slide-panel-title"/>
            <Region HBox.hgrow="ALWAYS"/>
            <Button text="âœ•" styleClass="btn btn-icon" onAction="#onCloseTransferPanel" prefWidth="32" prefHeight="32"/>
        </HBox>
        
        <ScrollPane fitToWidth="true" VBox.vgrow="ALWAYS" style="-fx-background-color: transparent;">
            <VBox spacing="16" style="-fx-padding: 24;">
                
                <VBox spacing="8">
                    <Label text="Wallet Destinataire" styleClass="form-label"/>
                    <ComboBox fx:id="cmbTransferTargetWallet" promptText="SÃ©lectionner wallet cible" prefWidth="1000" styleClass="field"/>
                    <Label text="Ou entrer le numÃ©ro de wallet manuellement" style="-fx-font-size: 10px; -fx-opacity: 0.6;"/>
                    <TextField fx:id="txtTransferWalletNumber" promptText="WLT-XXXXXXXX" styleClass="field"/>
                </VBox>
                
                <VBox spacing="8">
                    <Label text="Montant Ã  TransfÃ©rer (tCOâ‚‚)" styleClass="form-label"/>
                    <TextField fx:id="txtTransferAmount" promptText="Ex: 50.00" styleClass="field"/>
                    <HBox spacing="6" alignment="CENTER_LEFT">
                        <Label text="Disponible:" style="-fx-font-size: 11px; -fx-opacity: 0.7;"/>
                        <Label fx:id="lblTransferAvailable" text="0.00 tCOâ‚‚" style="-fx-font-size: 11px; -fx-font-weight: 600; -fx-text-fill: #10b981;"/>
                    </HBox>
                </VBox>
                
                <VBox spacing="8">
                    <Label text="RÃ©fÃ©rence / Message" styleClass="form-label"/>
                    <TextArea fx:id="txtTransferReference" promptText="Motif du transfert..." wrapText="true" 
                              prefRowCount="3" styleClass="field"/>
                </VBox>
                
                <Separator/>
                
                <VBox spacing="8" style="-fx-padding: 12; -fx-background-color: #eff6ff; -fx-border-color: #93c5fd; -fx-border-width: 2; -fx-background-radius: 8; -fx-border-radius: 8;">
                    <Label text="ðŸ“‹ RÃ©sumÃ© du Transfert" style="-fx-font-weight: 600; -fx-font-size: 13px;"/>
                    <HBox spacing="8">
                        <Label text="De:" style="-fx-font-weight: 600; -fx-min-width: 80;"/>
                        <Label fx:id="lblTransferFromWallet" text="â€”"/>
                    </HBox>
                    <HBox spacing="8">
                        <Label text="Vers:" style="-fx-font-weight: 600; -fx-min-width: 80;"/>
                        <Label fx:id="lblTransferToWallet" text="â€”"/>
                    </HBox>
                    <HBox spacing="8">
                        <Label text="Montant:" style="-fx-font-weight: 600; -fx-min-width: 80;"/>
                        <Label fx:id="lblTransferPreviewAmount" text="â€”" style="-fx-text-fill: #2563eb; -fx-font-weight: 700;"/>
                    </HBox>
                </VBox>
                
                <HBox spacing="12" style="-fx-padding: 12 0 0 0;">
                    <Button fx:id="btnConfirmTransfer" text="âœ“ Confirmer Transfert" styleClass="btn btn-primary" 
                            prefHeight="42" HBox.hgrow="ALWAYS" onAction="#onConfirmTransfer"/>
                    <Button text="Annuler" styleClass="btn btn-secondary" prefHeight="42" prefWidth="120" 
                            onAction="#onCloseTransferPanel"/>
                </HBox>
            </VBox>
        </ScrollPane>
    </VBox>

    <!-- SLIDE-IN PANEL OVERLAY: Calculate Emissions -->
    <VBox fx:id="emissionsCalculatorPanel" translateX="1200" managed="false" 
          styleClass="slide-panel" style="-fx-min-width: 620; -fx-max-width: 620;">
        <HBox alignment="CENTER_LEFT" spacing="12" styleClass="slide-panel-header">
            <Label text="âš¡" style="-fx-font-size: 24px;"/>
            <Label text="Calculateur d'Ã‰missions GHG" styleClass="slide-panel-title"/>
            <Region HBox.hgrow="ALWAYS"/>
            <Button text="âœ•" styleClass="btn btn-icon" onAction="#onCloseEmissionsPanel" prefWidth="32" prefHeight="32"/>
        </HBox>
        
        <ScrollPane fitToWidth="true" VBox.vgrow="ALWAYS" style="-fx-background-color: transparent;">
            <VBox spacing="20" style="-fx-padding: 24;">
                
                <!-- Scope Selector -->
                <VBox spacing="10">
                    <Label text="SÃ©lectionner Scope GHG" styleClass="form-label"/>
                    <HBox spacing="10">
                        <ToggleButton fx:id="btnScope1" text="Scope 1: Direct" styleClass="scope-toggle" prefHeight="44" HBox.hgrow="ALWAYS"/>
                        <ToggleButton fx:id="btnScope2" text="Scope 2: Ã‰nergie" styleClass="scope-toggle" prefHeight="44" HBox.hgrow="ALWAYS"/>
                        <ToggleButton fx:id="btnScope3" text="Scope 3: ChaÃ®ne" styleClass="scope-toggle" prefHeight="44" HBox.hgrow="ALWAYS"/>
                    </HBox>
                </VBox>
                
                <!-- Dynamic Form (Content changes based on scope selection) -->
                <VBox fx:id="emissionsFormContainer" spacing="16">
                    <!-- Controller will inject Scope-specific fields here -->
                </VBox>
                
                <Separator/>
                
                <!-- Calculation Result Preview -->
                <VBox fx:id="emissionsResultPane" spacing="12" style="-fx-padding: 16; -fx-background-color: #f9fafb; -fx-border-color: #e5e7eb; -fx-border-width: 2; -fx-background-radius: 8; -fx-border-radius: 8;" 
                      managed="false" visible="false">
                    <Label text="ðŸ“Š RÃ©sultat du Calcul" style="-fx-font-weight: 700; -fx-font-size: 14px;"/>
                    <HBox spacing="12" alignment="CENTER_LEFT">
                        <Label text="Ã‰missions:" style="-fx-font-weight: 600; -fx-min-width: 120;"/>
                        <Label fx:id="lblCalcResultAmount" text="â€”" style="-fx-font-size: 24px; -fx-font-weight: 700; -fx-text-fill: #dc2626;"/>
                    </HBox>
                    <HBox spacing="12">
                        <Label text="Tier QualitÃ©:" style="-fx-font-weight: 600; -fx-min-width: 120;"/>
                        <Label fx:id="lblCalcResultTier" text="â€”"/>
                    </HBox>
                    <HBox spacing="12">
                        <Label text="Incertitude:" style="-fx-font-weight: 600; -fx-min-width: 120;"/>
                        <Label fx:id="lblCalcResultUncertainty" text="â€”"/>
                    </HBox>
                    <HBox spacing="12">
                        <Label text="MÃ©thodologie:" style="-fx-font-weight: 600; -fx-min-width: 120;"/>
                        <Label fx:id="lblCalcResultMethodology" text="â€”" wrapText="true" style="-fx-max-width: 400;"/>
                    </HBox>
                </VBox>
                
                <HBox spacing="12" style="-fx-padding: 12 0 0 0;">
                    <Button fx:id="btnCalculateNow" text="âš¡ Calculer Maintenant" styleClass="btn btn-accent" 
                            prefHeight="42" HBox.hgrow="ALWAYS" onAction="#onCalculateEmissions"/>
                    <Button text="Fermer" styleClass="btn btn-secondary" prefHeight="42" prefWidth="120" 
                            onAction="#onCloseEmissionsPanel"/>
                </HBox>
            </VBox>
        </ScrollPane>
    </VBox>

    <!-- SLIDE-IN PANEL: Create Wallet -->
    <VBox fx:id="createWalletPanel" translateX="1200" managed="false" 
          styleClass="slide-panel" style="-fx-min-width: 520; -fx-max-width: 520;">
        <HBox alignment="CENTER_LEFT" spacing="12" styleClass="slide-panel-header">
            <Label text="ðŸŒ±" style="-fx-font-size: 24px;"/>
            <Label text="CrÃ©er Nouveau Wallet" styleClass="slide-panel-title"/>
            <Region HBox.hgrow="ALWAYS"/>
            <Button text="âœ•" styleClass="btn btn-icon" onAction="#onCloseCreateWalletPanel" prefWidth="32" prefHeight="32"/>
        </HBox>
        
        <ScrollPane fitToWidth="true" VBox.vgrow="ALWAYS" style="-fx-background-color: transparent;">
            <VBox spacing="16" style="-fx-padding: 24;">
                
                <VBox spacing="8">
                    <Label text="ðŸ“› Nom du Wallet" styleClass="form-label"/>
                    <TextField fx:id="txtCreateWalletName" promptText="Ex: Wallet Projet Solaire 2026" styleClass="field"/>
                </VBox>
                
                <VBox spacing="8">
                    <Label text="ðŸ”¢ NumÃ©ro (optionnel)" styleClass="form-label"/>
                    <TextField fx:id="txtCreateWalletNumber" promptText="Laissez vide pour gÃ©nÃ©ration automatique" styleClass="field"/>
                    <Label text="Laissez vide pour gÃ©nÃ©ration automatique" style="-fx-font-size: 10px; -fx-opacity: 0.6;"/>
                </VBox>
                
                <VBox spacing="8">
                    <Label text="ðŸ’° CrÃ©dits Initiaux (tCOâ‚‚)" styleClass="form-label"/>
                    <TextField fx:id="txtCreateWalletCredits" promptText="0.00" text="0" styleClass="field"/>
                </VBox>
                
                <Separator/>
                
                <HBox spacing="12" style="-fx-padding: 12 0 0 0;">
                    <Button fx:id="btnConfirmCreateWallet" text="âœ“ CrÃ©er Wallet" styleClass="btn btn-primary" 
                            prefHeight="42" HBox.hgrow="ALWAYS" onAction="#onConfirmCreateWallet"/>
                    <Button text="Annuler" styleClass="btn btn-secondary" prefHeight="42" prefWidth="120" 
                            onAction="#onCloseCreateWalletPanel"/>
                </HBox>
            </VBox>
        </ScrollPane>
    </VBox>

    <!-- SLIDE-IN PANEL: Edit Wallet -->
    <VBox fx:id="editWalletPanel" translateX="1200" managed="false" 
          styleClass="slide-panel" style="-fx-min-width: 520; -fx-max-width: 520;">
        <HBox alignment="CENTER_LEFT" spacing="12" styleClass="slide-panel-header">
            <Label text="âœï¸" style="-fx-font-size: 24px;"/>
            <Label text="Modifier Wallet" styleClass="slide-panel-title"/>
            <Region HBox.hgrow="ALWAYS"/>
            <Button text="âœ•" styleClass="btn btn-icon" onAction="#onCloseEditWalletPanel" prefWidth="32" prefHeight="32"/>
        </HBox>
        
        <ScrollPane fitToWidth="true" VBox.vgrow="ALWAYS" style="-fx-background-color: transparent;">
            <VBox spacing="16" style="-fx-padding: 24;">
                
                <VBox spacing="8">
                    <Label text="ðŸ“› Nom du Wallet" styleClass="form-label"/>
                    <TextField fx:id="txtEditWalletName" styleClass="field"/>
                </VBox>
                
                <VBox spacing="8">
                    <Label text="ðŸ”¢ NumÃ©ro Wallet" styleClass="form-label"/>
                    <TextField fx:id="txtEditWalletNumber" editable="false" styleClass="field"/>
                    <Label text="Le numÃ©ro ne peut pas Ãªtre modifiÃ©" style="-fx-font-size: 10px; -fx-opacity: 0.6;"/>
                </VBox>
                
                <Separator/>
                
                <HBox spacing="12" style="-fx-padding: 12 0 0 0;">
                    <Button fx:id="btnConfirmEditWallet" text="âœ“ Sauvegarder" styleClass="btn btn-primary" 
                            prefHeight="42" HBox.hgrow="ALWAYS" onAction="#onConfirmEditWallet"/>
                    <Button text="Annuler" styleClass="btn btn-secondary" prefHeight="42" prefWidth="120" 
                            onAction="#onCloseEditWalletPanel"/>
                </HBox>
            </VBox>
        </ScrollPane>
    </VBox>

    <!-- SLIDE-IN PANEL: Delete Wallet -->
    <VBox fx:id="deleteWalletPanel" translateX="1200" managed="false" 
          styleClass="slide-panel" style="-fx-min-width: 520; -fx-max-width: 520;">
        <HBox alignment="CENTER_LEFT" spacing="12" styleClass="slide-panel-header">
            <Label text="âš ï¸" style="-fx-font-size: 24px;"/>
            <Label text="Supprimer Wallet" styleClass="slide-panel-title"/>
            <Region HBox.hgrow="ALWAYS"/>
            <Button text="âœ•" styleClass="btn btn-icon" onAction="#onCloseDeleteWalletPanel" prefWidth="32" prefHeight="32"/>
        </HBox>
        
        <ScrollPane fitToWidth="true" VBox.vgrow="ALWAYS" style="-fx-background-color: transparent;">
            <VBox spacing="16" style="-fx-padding: 24;">
                
                <Label text="ÃŠtes-vous sÃ»r de vouloir supprimer ce wallet ?" style="-fx-font-size: 16px; -fx-font-weight: 600;"/>
                
                <VBox spacing="8" style="-fx-padding: 16; -fx-background-color: #fef2f2; -fx-border-color: #fecaca; -fx-border-width: 2; -fx-background-radius: 8; -fx-border-radius: 8;">
                    <Label text="âš ï¸ Attention" style="-fx-font-weight: 600; -fx-font-size: 13px; -fx-text-fill: #dc2626;"/>
                    <Label text="Cette action est irrÃ©versible. Toutes les donnÃ©es du wallet seront supprimÃ©es dÃ©finitivement." 
                           wrapText="true" style="-fx-font-size: 12px;"/>
                    <Label text="Wallet Ã  supprimer:" style="-fx-font-weight: 600; -fx-margin: 12 0 0 0;"/>
                    <Label fx:id="lblDeleteWalletName" text="â€”" style="-fx-font-weight: 600; -fx-font-size: 14px; -fx-text-fill: #dc2626;"/>
                </VBox>
                
                <Separator/>
                
                <VBox spacing="8">
                    <Label text="ðŸ“ Confirmation" styleClass="form-label"/>
                    <CheckBox fx:id="chkDeleteWalletConfirm" text="Je confirme la suppression de ce wallet"/>
                </VBox>
                
                <HBox spacing="12" style="-fx-padding: 12 0 0 0;">
                    <Button fx:id="btnConfirmDeleteWallet" text="âŒ Supprimer DÃ©finitivement" styleClass="btn btn-danger" 
                            prefHeight="42" HBox.hgrow="ALWAYS" onAction="#onConfirmDeleteWallet" disable="true"/>
                    <Button text="Annuler" styleClass="btn btn-secondary" prefHeight="42" prefWidth="120" 
                            onAction="#onCloseDeleteWalletPanel"/>
                </HBox>
            </VBox>
        </ScrollPane>
    </VBox>

</StackPane>
