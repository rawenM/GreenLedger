<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.scene.layout.*?>
<?import javafx.scene.control.*?>
<?import javafx.geometry.Insets?>
<?import javafx.scene.image.Image?>
<?import javafx.scene.image.ImageView?>
<?import javafx.scene.canvas.Canvas?>
<?import javafx.scene.chart.LineChart?>
<?import javafx.scene.chart.NumberAxis?>

<HBox xmlns="http://javafx.com/javafx/20.0.2"
      xmlns:fx="http://javafx.com/fxml/1"
      fx:controller="Controllers.CarbonAuditController"
      spacing="0" styleClass="page">

    <!-- Navigation Sidebar -->
    <VBox prefWidth="220" styleClass="sidebar">

        <HBox alignment="CENTER_LEFT" spacing="8">
            <Label text="ðŸƒ" style="-fx-font-size: 20px;"/>
            <Label text="GreenLedger Audit" styleClass="sidebar-title"/>
        </HBox>

        <Separator styleClass="sidebar-sep"/>

        <Button text="â† Retour" styleClass="btn btn-secondary" onAction="#handleBack"/>

        <Button fx:id="btnGestionProjets" text="ðŸ“ Voir Projets" styleClass="nav-btn"/>
        <Button fx:id="btnGestionEvaluations" text="ðŸ“Š Gestion Ã‰valuations" styleClass="nav-btn"/>
        <Button fx:id="btnSettings" text="âš™ Settings" styleClass="nav-btn"/>

        <!-- Spacer to push content to bottom -->
        <Region VBox.vgrow="ALWAYS"/>

        <VBox spacing="2" alignment="TOP_LEFT" style="-fx-padding: 10 0 0 0;">
            <Label fx:id="lblProfileName" styleClass="page-title"/>
            <Label fx:id="lblProfileType" styleClass="page-subtitle"/>
            <Button text="âœï¸ Modifier profil" styleClass="btn-secondary" onAction="#handleEditProfile"/>
        </VBox>
    </VBox>

    <!-- Content -->
    <VBox spacing="0" HBox.hgrow="ALWAYS" styleClass="content-area">

        <HBox fx:id="evaluationBanner" visible="false" managed="false" styleClass="banner-success" alignment="CENTER_LEFT">
            <padding>
                <Insets top="10" right="16" bottom="10" left="16"/>
            </padding>
            <Label fx:id="lblEvaluationBanner" text="" styleClass="banner-text"/>
        </HBox>

        <VBox spacing="8" styleClass="hero-header">
            <Label text="Centre d'evaluation carbone" styleClass="hero-title"/>
            <Label text="Suivez les criteres, validez les projets et analysez les impacts en un coup d'oeil." styleClass="hero-subtitle"/>
        </VBox>

        <!-- Stats Section -->
        <HBox spacing="16" alignment="CENTER_LEFT" styleClass="hero-stats">
            <padding>
                <Insets top="0" right="32" bottom="12" left="32"/>
            </padding>

            <VBox spacing="6" styleClass="stat-card" HBox.hgrow="ALWAYS">
                <Label text="PROJETS EN AUDIT" styleClass="stat-title"/>
                <Label fx:id="lblProjetsAudit" text="0" styleClass="stat-value accent-green"/>
                <Label text="ðŸ“Š" style="-fx-font-size: 18px;"/>
            </VBox>

            <VBox spacing="6" styleClass="stat-card" HBox.hgrow="ALWAYS">
                <Label text="PROJETS EVALUES" styleClass="stat-title"/>
                <Label fx:id="lblProjetsEvalues" text="0" styleClass="stat-value accent-blue"/>
                <Label text="âœ…" style="-fx-font-size: 18px;"/>
            </VBox>

            <VBox spacing="6" styleClass="stat-card" HBox.hgrow="ALWAYS">
                <Label text="CRITERES D'IMPACT" styleClass="stat-title"/>
                <Label fx:id="lblCriteresImpact" text="0" styleClass="stat-value accent-amber"/>
                <Label text="âš–ï¸" style="-fx-font-size: 18px;"/>
            </VBox>
        </HBox>

        <ScrollPane fitToWidth="true" fitToHeight="true" VBox.vgrow="ALWAYS"
                    style="-fx-background-color: transparent; -fx-background: transparent;">
            <VBox spacing="12">
                <padding>
                    <Insets top="6" right="20" bottom="20" left="20"/>
                </padding>

                <!-- Evaluation + Criteria Section -->
                <VBox spacing="10" styleClass="card card-focus compact-card">
                    <padding>
                        <Insets top="18" right="18" bottom="18" left="18"/>
                    </padding>

                    <HBox alignment="CENTER_LEFT" spacing="10" styleClass="section-header">
                        <Label text="âš–ï¸" style="-fx-font-size: 18px;"/>
                        <VBox spacing="2">
                            <Label text="CritÃ¨res d'impact" styleClass="section-title"/>
                            <Label text="Definissez les criteres et pesez leur importance." styleClass="section-subtitle"/>
                        </VBox>
                    </HBox>

                    <TableView fx:id="tableCriteres"
                               styleClass="table-card selectable-table"
                               prefHeight="240" minHeight="200">
                        <placeholder>
                            <VBox alignment="CENTER" spacing="8" style="-fx-padding: 40;">
                                <Label text="âš–ï¸" style="-fx-font-size: 32px; -fx-opacity: 0.3;"/>
                                <Label text="Aucun critÃ¨re dÃ©fini" styleClass="placeholder-label"/>
                                <Label text="Ajoutez vos critÃ¨res (nom, poids, description) avant l'Ã©valuation." styleClass="select-hint"/>
                            </VBox>
                        </placeholder>
                        <columns>
                            <TableColumn fx:id="colCritereNom" text="Nom" prefWidth="220"/>
                            <TableColumn fx:id="colCritereNote" text="Poids" prefWidth="120"/>
                            <TableColumn fx:id="colCritereCommentaire" text="Description" prefWidth="520"/>
                        </columns>
                    </TableView>

                    <Separator/>

                    <VBox fx:id="boxAddCritere" spacing="12">
                        <HBox spacing="12">
                            <VBox spacing="8" HBox.hgrow="ALWAYS">
                                <Label text="Nom du critÃ¨re" styleClass="form-label"/>
                                <TextField fx:id="txtNomCritere"
                                           promptText="Ex: Ã‰missions CO2"
                                           styleClass="field"/>
                            </VBox>
                            <VBox spacing="8" prefWidth="150">
                                <Label text="Poids" styleClass="form-label"/>
                                <TextField fx:id="txtNote"
                                           promptText="1-10"
                                           styleClass="field"/>
                            </VBox>
                        </HBox>

                        <VBox spacing="8">
                            <Label text="Commentaire technique" styleClass="form-label"/>
                            <TextArea fx:id="txtCommentaireCritere"
                                      promptText="DÃ©tails sur le critÃ¨re d'impact..."
                                      wrapText="true"
                                      styleClass="field textarea"
                                      style="-fx-pref-height: 80px;"/>
                        </VBox>

                        <HBox spacing="12">
                            <Button text="âž• Ajouter CritÃ¨re"
                                    onAction="#ajouterCritere"
                                    styleClass="btn-primary"/>
                            <Button text="âœï¸ Modifier CritÃ¨re"
                                    onAction="#modifierCritere"
                                    styleClass="btn-secondary"/>
                            <Button text="ðŸ—‘ï¸ Supprimer CritÃ¨re"
                                    onAction="#supprimerCritere"
                                    styleClass="btn-danger"/>
                        </HBox>
                    </VBox>

                    <Separator/>

                    <HBox alignment="CENTER_LEFT" spacing="8">
                        <Label text="ðŸ“‹" style="-fx-font-size: 18px;"/>
                        <Label text="CritÃ¨res de l'Ã©valuation" styleClass="page-title"/>
                    </HBox>

                    <VBox fx:id="criteriaFieldsBox" spacing="10"/>

                    <Separator/>

                    <HBox alignment="CENTER_LEFT" spacing="8">
                        <Label text="ðŸ“" style="-fx-font-size: 18px;"/>
                        <Label text="Finaliser l'Ã©valuation" styleClass="page-title"/>
                    </HBox>

                    <HBox spacing="12">
                        <VBox spacing="8" prefWidth="320">
                            <Label text="Projet sÃ©lectionnÃ©" styleClass="form-label"/>
                            <Label fx:id="lblSelectedProjectName" text="â€”" styleClass="field-readonly"/>
                            <TextField fx:id="txtIdProjet" editable="false" visible="false" managed="false"/>
                        </VBox>
                    </HBox>

                    <VBox spacing="8">
                        <Label text="Observations" styleClass="form-label"/>
                        <TextArea fx:id="txtObservations"
                                  promptText="Commentaires sur l'evaluation..."
                                  wrapText="true"
                                  styleClass="field textarea"
                                  style="-fx-pref-height: 100px;"/>
                    </VBox>

                    <HBox spacing="12">
                        <Button text="âž• Creer Evaluation" onAction="#ajouterEvaluation" styleClass="btn-primary"/>
                        <Button text="âœï¸ Modifier" onAction="#modifierEvaluation" styleClass="btn-secondary"/>
                        <Button text="ðŸ—‘ï¸ Supprimer" onAction="#supprimerEvaluation" styleClass="btn-danger"/>
                    </HBox>

                </VBox>

                <!-- Electronic Signature (last section) -->
                <VBox spacing="12" styleClass="card">
                    <HBox alignment="CENTER_LEFT" spacing="8">
                        <Label text="âœï¸" style="-fx-font-size: 18px;"/>
                        <Label text="Signature Ã©lectronique" styleClass="page-title"/>
                    </HBox>
                    <Label text="Signez ci-dessous. La signature sera incluse dans le PDF." styleClass="select-hint"/>
                    <Canvas fx:id="signatureCanvas" width="1200.0" height="200.0" HBox.hgrow="ALWAYS"/>
                    <HBox spacing="8" alignment="CENTER_LEFT">
                        <Button text="Effacer" onAction="#handleClearSignature" styleClass="btn-secondary"/>
                        <Region HBox.hgrow="ALWAYS"/>
                        <Button fx:id="btnExportPdf" text="ðŸ“„ Exporter PDF" onAction="#handleExportPdf" styleClass="btn-primary"/>
                    </HBox>
                </VBox>

            </VBox>
        </ScrollPane>

    </VBox>

</HBox>


